其他

## 悬垂指针与野指针

### 定义
悬垂指针：指向已经释放的内存区域，iOS中常见的是unsafe_unretained
野指针：未经初始化的指针。在iOS中所有指针都初始化为nil？

严格来说是以上定义，但是大部分情况并没有区分太明确。。。

### 问：野指针一定会崩溃吗？
不一定。因为内存释放后，**并不代表内存会立刻被复写**

### 检测
Xcode在debug模式下，可以使用Zombie来检测。实现原理如下

```
//runtime 源码中对象正常dealloc的流程
id object_dispose(id obj)
{
    if (!obj) return nil;

    objc_destructInstance(obj);    
    free(obj);

    return nil;
}
```

僵尸对象hook了这个方法，调用`objc_destructInstance`之后就return了，不在free内存。
同时生成"_NSZombie_" + clsName类名的类型，调用`objc_setClass(self, zombieCls);`修改对象的isa的指针让它指向僵尸类。如果这个对象，再次收到objc_msgSend时，调用`abort()`崩溃并打印出调用的方法。

为了避免对象无法释放内存一直增长，可以生成僵尸对象之后的30s，将其释放掉。

其他一些优化的方案：
1.添加白名单，针对系统类、检测类等，不予处理
2.设置内存阈值，当僵尸对象达到某个值的时候，使用合适的淘汰算法释放掉部分。

参考文章：http://sindrilin.com/2017/11/01/local_zombie.html#%E5%AE%9A%E4%BD%8D

