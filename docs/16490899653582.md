图片的优化
# 1.图片加载的过程
1.从硬盘读取到内核空间
2.从内核空间拷贝到用户空间
3.生成UIImage, 并赋值给UIImageView
4.如果图片没有解码，则触发解码操作，生成bitmap 提交给CALayer
5.CATransaction捕获到UIImageView layer树发生变化
6.主线程runloop提交CATransaction到GPU，开始进行图像渲染
6.1 如果图像没有字节对齐，CA会拷贝一份，进行对齐
6.2GPU 开始渲染

简单来说：
- 从磁盘读取到内存(因为文件读取是系统调用，因此涉及到内核态和用户态的切换)
- 读取到的数据是压缩数据，需要解码为bitmap才能渲染(图片赋值给imageView.image发生的)
- bitmap提交给CALayer，在runloop即将休眠的时候通过CoreAnimation提交给renderServer


# 2.优化图片的手段
## 2.1 降采样，生成缩略图
请记住，下采样是一个占用CPU功率的过程。因此，使用适当缩放的图像源仍然比向下采样高清图像更可取。
换句话说，您应考虑仅在需要**显示图像的尺寸远高于屏幕上所需尺寸的图像时使用下采样**。

## 2.2 异步解码
解码默认在主线程，且是一个消耗CPU的操作，可以使用异步解码。
SD在下载好图片之后，会对其解码，再返回给调用方；同时从磁盘读取文件之后，也会进行解码，在存储到内存

## 2.3 mmap
可以考虑将解码后的图片存储到磁盘，当然这样会造成磁盘占用过大，需要控制好容量。
同时，将解码后数据存储到磁盘后，可以考虑使用mmap读取图片，减少内核到用户空间copy耗时提升效率。注意：只有在文件较大的时候，使用mmap才比直接read()效率高

## 2.4 字节对齐
为了提升渲染性能，渲染的时候不是一个像素一个像素的渲染，而是一块一块的，因此需要字节对齐。
实施方法：只需要在解码图像时bitmap画布的bytesPerRow设为64的倍数即可。

https://github.com/Yuan91/Performance/blob/master/iOS%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96.md
